<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HTML Card with Login Modal and Navigation Bar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous">
  </script>
  <!-- Include jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <!-- Include Bootstrap JS -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <!-- Include Link for rating Star Icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>

  <div id="navbarContent"></div>
  <!-- script for navbar include -->
  <script src="/js/navbar.js"></script>


  <header>
    <div class="container">
      <h1 class="text-center">Workspaces</h1>
    </div>
  </header>

  <main>
    <!-- Cards Landing Page Structre -->
    <div class="container">
      <div class="row row-cols-4 gy-4" id="cardContainer">


      </div>
    </div>

    <!-- Modal Container for Properties -->
    <div id="property-modals">


      
    <!-- MODAL EDITING A WORKSPACE -->
    <div class="container">
      <div class="modal fade" id="editWorkspace">
          <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                  <div class="modal-header">
                      <h2 class="modal-title">Edit Workspcace</h2>
                      <button class="btn-close" data-bs-dismiss="modal" data-bs-target="#signUp"></button>
                  </div>
                  <div class="modal-body">
                      <form novalidate id="editMyWorkspace">
                          <input type="number" name="edit_propertyID" id="edit_propertyID" hidden>
                          <input type="number" name="edit_workspaceID" id="edit_workspaceID" hidden>
                          <input type="number" name="lease_id" id="lease_id" hidden>
                          <div class="form-floating">
                              <input type="text" name="name" id="name" class="form-control" placeholder="Meeting Room"
                                  required>
                              <label for="name" class="form-label">Type of Workspace</label>
                              <div class="invalid-feedback">Invalid Workspace</div>
                          </div>
                          <br>
                          <div class="form-floating">
                              <input type="number" name="capacity" id="capacity" class="form-control" placeholder="3"
                                  required>
                              <label for="capacity" class="form-label">Maximum Capacity (number of
                                  individuals)</label>
                              <div class="invalid-feedback">Invalid input</div>
                          </div>
                          <br>
                          <select name="lease_term" id="lease_term" class="form-select" required>
                              <option value="term" disabled selected>Term Type</option>
                              <option value="per 30 minutes">per 30 minutes</option>
                              <option value="per 1 hour">per 1 hour</option>
                              <option value="per 2 hours">per 2 hours</option>
                          </select>
                          <br>
                          <div class="form-floating">
                              <input type="number" name="price" id="price" class="form-control" placeholder="30"
                                  required>
                              <label for="price" class="form-label">Price</label>
                              <div class="invalid-feedback">Invalid input</div>
                          </div>
                          <br>
                          <div class="form-floating">
                              <textarea class="form-control" name="description" id="description" cols="30" rows="10"
                                  required></textarea>
                              <label for="description" class="form-label">Short Description</label>
                              <div class="invalid-feedback">Please enter a short description</div>
                          </div>
                          <br>
                          <button type="submit" class="btn btn-primary btn-sm float-end editWorkspace">Edit
                              Workspace</button>
                      </form>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- MODAL FOR DELETING A WORKSPACE -->
  <div class="container">
      <div class="modal fade" id="deleteWorkspace">
          <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                  <div class="modal-header">
                      <input type="number" name="delete_propertyID" id="delete_propertyID" hidden>
                      <input type="number" name="delete_workspaceID" id="delete_workspaceID" hidden>
                      <h2 class="modal-title">Delete Workspace</h2>
                      <button class="btn-close" data-bs-dismiss="modal" data-bs-target="#signUp"></button>
                  </div>
                  <div class="modal-body">
                      <p>Are you sure you want to delete this workspace?</p>
                      <br>
                      <button type="submit" class="btn btn-primary btn-sm float-end">No, don't delete</button>
                      <br><br>
                      <button type="submit" class="btn btn-primary btn-sm float-end ">Yes, delete workspace</button>
                  </div>
              </div>
          </div>
      </div>
  </div>


    </div>
  </main>
  <footer class="footer bg-dark text-light py-3">

    <div class="container text-center">
      <p>&copy; Co-working Registry. All rights reserved.</p>
    </div>
  </footer>


  <script>
    const userID = localStorage.getItem('userID');
    const token2 = localStorage.getItem('token');

    const handleCreateLease = async (propertyId, workspaceId) => {
      const myHeaders = new Headers();
      myHeaders.append("Content-type", "application/json");
      myHeaders.append("Authorization", `Bearer ${token2}`);

      const requestBody = JSON.stringify({
        user_id: userID,
        property_id: propertyId,
        workspace_id: workspaceId,
      });

      const requestOptions = {
        method: 'POST',
        headers: myHeaders,
        body: requestBody,
        redirect: 'follow'
      };

      try {
        const response = await fetch('http://143.198.237.154/api/lease/book', requestOptions);
        const results = await response.text();
        console.log(results);

        if (response.ok) {
          console.log("Successfully booked and added to the database");
          const refresh = document.getElementById('refreshdiv')

          refresh.innerHTML = `
          <head>
            <meta http-equiv="refresh" content="1">
        </head>`

        } else {
          console.log("Booking failed");
        }
      } catch (err) {
        console.log('err', err);
        alert('An error occurred. Please try again later!');
      }
    };

    document.addEventListener('DOMContentLoaded', function () {
      const bookWorkspace = document.querySelectorAll('.book-workspace');

      bookWorkspace.forEach(function (button) {
        button.addEventListener('click', function () {
          if (!token2) {
            alert('Please Login to an Account');
          } else {
            console.log("I am currently booking");
            const propertyId = this.getAttribute('data-property-id');
            const workspaceId = this.getAttribute('data-workspace-id');

            handleCreateLease(propertyId, workspaceId);
          }
        });
      });
    });



document.addEventListener('click', function (event) {
    const target = event.target;
    if (target.classList.contains('book-workspace')) {
      if (!token2) {
        alert('Please Login to an Account');
      } else {
        const propertyId = target.getAttribute('data-property-id');
        const workspaceId = target.getAttribute('data-workspace-id');
        handleCreateLease(propertyId, workspaceId);
      }
    }
  });

  </script>


<!-- SCRIPT STORING ID's WORKSPACE -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
  const workspaceContainer = document.getElementById('cardContainer'); // Parent element for delegation


  // For Editing Workspace
  workspaceContainer.addEventListener('click', function (event) {
      if (event.target.classList.contains('editWorkspace')) {
          const editWorkspaceId = event.target.getAttribute('edit_');
          const editWorkspaceInput = document.getElementById('edit_WorkspaceID');
          const editWorkspacePropertyId = event.target.getAttribute('edit_'); /////EDIT ALL ATTRIBUTES
          const editWorkspacePropertyInput = document.getElementById('edit_WorkspacePropertyID');
          const editWorkspaceLeaseId = event.target.getAttribute('edit_');
          const editWorkspaceLeaseInput = document.getElementById('edit_WorkspaceLeaseID');
          editWorkspaceInput.value = editWorkspaceId;
      }
  })

  //For Deleting Workspace
  // workspaceContainer.addEventListener('click', function (event) {
  //     if (event.target.classList.contains('deleteWorkspace')) {
  //         const deleteWorkspaceId = event.target.getAttribute('');
  //         const deleteWorkspaceInput = document.getElementById('delete_WorkspaceID');
  //         deleteWorkspaceInput.value = deleteWorkspaceId;
  //     }
  // })

}); 

</script>


<!-- SCRIPT TO  and edit DELETE WORKSPACE -->
<script>
  const token3 = localStorage.getItem('token');
  const userID3 = localStorage.getItem('userID');

  const editWorkspace = async(event) => {
      event.preventDefault();

      const editWorkspaceForm = document.getElementById('editMyWorkspace');
      const editWorkspaceData = new FormData(editWorkspaceData);

      const myHeaders = new Headers();
      myHeaders.append("Content-type", "application/json")
      myHeaders.append("Authorization", `Bearer ${token2}`);

      const requestBody = JSON.stringify({
          //Input all info here
            name:workspaceFormData.get('name'),
            capacity:workspaceFormData.get('capacity'),
            photos: workspaceFormData.get('image') ? workspaceFormData.get('image').name : null,
            property_id: workspaceFormData.get('propertyID'),
            description : workspaceFormData.get('description'),
            lease_term : workspaceFormData.get('lease_term'),
            price: workspaceFormData.get('price')
      });

      console.log(requestBody);

      const requestOptionsAW = {
          method: 'POST',
          headers: myHeaders,
          body: requestBody,
          redirect: 'follow'
      }

      try{
          const responseAW = await fetch('http://143.198.237.154/api/workspace/create',requestOptionsAW);
          const resultsAW = await responseAW.text();

          if(responseAW.ok){
              console.log("succesfully added")
          }
      }catch (err) {
          console.log('err', err);

          alert('An error occured, Please Try again later!');
      }
  }

  // const deleteWorkspace = async (event) => {
  //     event.preventDefault()

  //     const deleteWorkspaceForm = document.getElementById('deleteMyWorkspace');
  //     const deleteWorkspaceData = new FormData(deleteWorkspaceData);

  //     ////PUT CODE HERE

  // }


  if(!token2){
      alert('Please Login to an Account');
  }else{
      const editWorkspaceForm = document.getElementById('editMyWorkspace');
      editWorkspaceForm.addEventListener('submit', editProperty);

      // const deleteWorkspaceForm = document.getElementById('deleteMyWorkspace');
      // deleteWorkspaceForm.addEventListener('submit', deleteProperty)
  }

</script>

  <!-- Creates a card for every Workspace -->
  <!-- CREATES MODALS FOR EACH WORKSPACE -->
  <script src="/js/cards.js"></script>
</body>

</html>