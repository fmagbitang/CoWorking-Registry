<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HTML Card with Login Modal and Navigation Bar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous">
  </script>
  <!-- Include jQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <!-- Include Bootstrap JS -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <!-- Include Link for rating Star Icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>

  <div id="navbarContent"></div>
  <!-- script for navbar include -->
  <script src="/js/navbar.js"></script>


  <header>
    <div class="container">
      <h1 class="text-center" >Workspaces</h1>
    </div>
  </header>

  <main>
    <!-- Cards Landing Page Structre -->
    <div class="container">
      <div class="row row-cols-4 gy-4" id="cardContainer">
        
      
      </div>
    </div>

    <!-- Modal Container for Properties -->
    <div id="property-modals">

    </div>
  </main>
  <footer class="footer bg-dark text-light py-3">

    <div class="container text-center">
      <p>&copy; Co-working Registry. All rights reserved.</p>
    </div>

  </footer>

  
  <script>
    const userID = localStorage.getItem('userID');
    const token2 = localStorage.getItem('token');
  
    const handleCreateLease = async (propertyId, workspaceId) => {
      const myHeaders = new Headers();
      myHeaders.append("Content-type", "application/json");
      myHeaders.append("Authorization", `Bearer ${token2}`);
  
      const requestBody = JSON.stringify({
        user_id: userID,
        property_id: propertyId,
        workspace_id: workspaceId,
      });
  
      const requestOptions = {
        method: 'POST',
        headers: myHeaders,
        body: requestBody,
        redirect: 'follow'
      };
  
      try {
        const response = await fetch('http://143.198.237.154/api/lease/book', requestOptions);
        const results = await response.text();
        console.log(results);
  
        if (response.ok) {
          console.log("Successfully booked and added to the database");
        } else {
          console.log("Booking failed");
        }
      } catch (err) {
        console.log('err', err);
        alert('An error occurred. Please try again later!');
      }
    };
  

  
    document.addEventListener('DOMContentLoaded', function () {
      const bookWorkspace = document.querySelectorAll('.book-workspace');
  
      bookWorkspace.forEach(function (button) {
        button.addEventListener('click', function () {
          if (!token2) {
            alert('Please Login to an Account');
          } else {
            console.log("I am currently booking");
            const propertyId = this.getAttribute('data-property-id');
            const workspaceId = this.getAttribute('data-workspace-id');
  
            handleCreateLease(propertyId, workspaceId);
          }
        });
      });
    });


 
// EVENT DELEGATIOn

//   document.addEventListener('DOMContentLoaded', function () {
//   const propertyContainer = document.getElementById('property-modals'); 

//     propertyContainer.addEventListener('click', function (event) {
//       if (event.target.classList.contains('book-workspace')) {
//         if (!token2) {
//           alert('Please Login to an Account');
//         } else {
//           console.log("I am currently booking");
//           // const propertyId = target.getAttribute('data-property-id');
//           // const workspaceId = target.getAttribute('data-workspace-id');
//           // console.log("The proerty Id is" + {propertyId} + "\nThe workspaceID is" + {workspaceId})
//           // handleCreateLease(propertyId, workspaceId);
//         }
//     }
//     // console.log("working");
//   });
// });
  </script>



  <!-- Creates a card for every Workspace -->
  <!-- CREATES MODALS FOR EACH WORKSPACE -->
  <script src="/js/cards.js"></script>
</body>

</html>